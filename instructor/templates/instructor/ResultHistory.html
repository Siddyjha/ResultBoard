{% extends 'instructor/Home.html' %}

{% block title %} Result History {% endblock %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="res-hist">
                    <h2><span class="label label-warning">Result History</span></h2>
                    <ul class="list-group list-group-flush">
                        {% for res in prev_results %}
                            <li class="list-group-item" onclick="get_result_preview({{ res.pk}})">{{ res.exam_type}} - {{ res.get_date}}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalLong" id="mod-trig" style="display: none">
        Launch demo modal
    </button>
    
    <!-- Modal -->
    <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Roll Number</th>
                            <th scope="col">Marks</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">

                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>

    <script>
        function get_result_preview(id){
            $.ajax({
                url: '{% url "instructor:ResultPreview" %}',
                data: {'id': id},
                dataType: 'json',
                success:  function(data){
                    var content;
                    var desc = data.desc;
                    var json = data.json;
                    json = JSON.parse(json);
                    for(var i=0; i< json.length; i+=1){
                        var obj = json[i];
                        content += `<tr> <td>${obj.rollnum}</td> <td>${obj.marks}</td> </tr>`
                    }

                    $("#tbody").html(content);
                    $("#exampleModalLongTitle").html(`Exam Type: ${desc.exam_type} <br> Created on: ${desc.created_on}`);
                    $("#mod-trig").click();
                },
                error: function(data){console.log("error");}
            });
        }
    </script>
{% endblock%}